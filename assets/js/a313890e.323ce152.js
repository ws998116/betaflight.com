"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9541],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>f});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=u(a),p=i,f=h["".concat(s,".").concat(p)]||h[p]||d[p]||r;return a?n.createElement(f,o(o({ref:t},c),{},{components:a})):n.createElement(f,o({ref:t},c))}));function f(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:i,o[1]=l;for(var u=2;u<r;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},38324:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var n=a(87462),i=(a(67294),a(3905));const r={},o=void 0,l={unversionedId:"Archive/Runaway-Takeoff-Prevention",id:"Archive/Runaway-Takeoff-Prevention",title:"Runaway-Takeoff-Prevention",description:"Description",source:"@site/docs/Archive/Runaway-Takeoff-Prevention.md",sourceDirName:"Archive",slug:"/Archive/Runaway-Takeoff-Prevention",permalink:"/docs/Archive/Runaway-Takeoff-Prevention",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"RunCam Device Protocol",permalink:"/docs/Archive/RunCam-Device-Protocol"},next:{title:"Problems with SBus and FPort when using OpenTX",permalink:"/docs/Archive/SBus-FPort-and-RC-Smoothing-when-using-OpenTX"}},s={},u=[{value:"Description",id:"description",level:2},{value:"WARNING",id:"warning",level:2},{value:"Operation",id:"operation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Debugging",id:"debugging",level:2},{value:"Known Issues",id:"known-issues",level:2},{value:"Version History",id:"version-history",level:2}],c={toc:u};function h(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"description"},"Description"),(0,i.kt)("p",null,'Runaway Takeoff Prevention is a safety feature designed to detect and auto-disarm if an unsafe response is detected by the PID controller on the first takeoff after power-up. Sometimes referred to as a "Tasmanian Devil", some configuration or hardware issues can cause a violent and dangerous out-of-control spin immediately after arming or as the throttle is raised for takeoff. Some common causes are:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Props on incorrectly"),(0,i.kt)("li",{parentName:"ul"},"Motor order wrong"),(0,i.kt)("li",{parentName:"ul"},"Motors spinning the wrong direction"),(0,i.kt)("li",{parentName:"ul"},"Flight controller (gyro) orientation incorrect")),(0,i.kt)("p",null,"This feature is designed to only intervene and auto-disarm during a runaway event on first takeoff after powering up, and should have no impact on normal flight."),(0,i.kt)("h2",{id:"warning"},"WARNING"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"While this feature is designed to prevent most types of runaway takeoff events, it cannot be guaranteed that all such occurrences will be prevented. The wide range of hardware and variable circumstances mean that there may be cases where this feature may be unable to provide additional protection. As always it is the pilot's responsibility to ensure their aircraft is configured properly and safe to fly.")),(0,i.kt)("h2",{id:"operation"},"Operation"),(0,i.kt)("p",null,"The Runaway Takeoff Prevention feature is enabled by default beginning with Betaflight 3.3. There are two phases of operation:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Takeoff:")),(0,i.kt)("p",null,"After the first arm after powering up, the feature looks for excessive PID responses that indicate the craft is not responding properly and escalating towards an out-of-control runaway event. If detected the flight controller will automatically disarm. A ",(0,i.kt)("a",{parentName:"p",href:"Arming-Sequence-&-Safety#beeper"},"beep pattern"),' - one long, one short - will indicate that a runaway takeoff event occurred and "RUNAWAY" will be displayed as the arming disabled reason in both the OSD and CLI.'),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Successful Flight:")),(0,i.kt)("p",null,"Once the craft successfully takes off and is in controlled flight the feature will deactivate for the remainder of the battery. After that finial successful take-off, the pilot can arm and disarm at any time without re-activating the feature."),(0,i.kt)("p",null,"The detection of successful flight involves looking at throttle level and control stick activity along with the craft responding correctly to the PID controller over a period of time. By deactivating the feature after successful flight is detected we prevent subsequent inadvertent disarming caused by crashes or gate/branch clips."),(0,i.kt)("p",null,"This short video is an example of the feature activating: ",(0,i.kt)("a",{parentName:"p",href:"https://youtu.be/FEczCjAWv_0"},"https://youtu.be/FEczCjAWv_0")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Unsuccessful Flight:")),(0,i.kt)("p",null,"If triggered, the pilot should disarm immediately. The feature will remain active until a successful flight clears the problem. Re-arming without solving the problem will likely re-trigger the protection. False triggering can, rarely, occur. It can be minimised by modifying the configuration parameters."),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"In general there shouldn't be any need to adjust the configuration parameters. Default values were chosen based on testing and should give good results. However as is always the case, additional testing and feedback from the users may identify some further optimization to these settings. It's anticipated that once the Runaway Takeoff Prevention feature matures that some of the tunable values might be eliminated and replaced with optimized hard-coded values to simplify the configuration."),(0,i.kt)("p",null,"The first group of parameters configure how the feature detects and activates during a runaway takeoff event:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_prevention = ON")),(0,i.kt)("p",null,"Set this to ",(0,i.kt)("inlineCode",{parentName:"p"},"OFF")," to completely disable the feature. Note that there will be no protection against runaway takeoff events and the firmware will behave as it did before the feature was implemented. ",(0,i.kt)("strong",{parentName:"p"},"WE DO NOT RECOMMEND DISABLING THE FEATURE.")," Runaway events can be quite violent and personal injury or damage to property can occur for even seemingly minor setup issues like putting the props on incorrectly."),(0,i.kt)("p",null,"The remaining parameters affect the logic used to detect normal controlled flight and deactivate the feature for the remainder of the battery:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_deactivate_throttle_percent = 25")," (reduced to 20 in BF4.0)"),(0,i.kt)("p",null,"Determines the minimum throttle percentage threshold where successful flight can be considered. Valid values range from 0 to 100. Along with throttle level the logic also requires activity on the roll, pitch or yaw sticks (minimum 15% deflection) along with the PID controller successfully controlling the craft with the PID_sum staying under control. When these conditions are met the logic accumulates successful flight time. Generally you won't need to adjust this value as most quads require around 25% or more throttle to takeoff/hover. The exception may be if you have and extremely powerful or light craft that is capable of flying well below 25% throttle. In this case you may want to lower this value closer to your actual hover throttle percent. If this value is set too low it's possible that the logic will deactivate too quickly and may not trigger in a real runaway event. Setting it too high will result in the logic taking more flight time to deactivate as it only accumulates flight time when the throttle is above the setting."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_deactivate_delay = 500")),(0,i.kt)("p",null,"This is the amount of successful flight time in milliseconds that must be accumulated to deactivate the feature. Valid values range from 100 (0.1 seconds) to 1000 (1 second). The default value of 500 (0.5 seconds) seems to be very reliable and shouldn't need to be adjusted. The goal is to deactivate the logic after a \"reasonable\" but short period of time once we've determined the craft is flying normally. However we want it to deactivate before we might reach the first point where a crash or other event may occur (like at the first gate during a race). Raising this value will delay the deactivation and it's possible that a crash or gate/branch clip could cause an unintended disarm. Lowering this value too much could result in the logic deactivating too soon and not providing protection in a runaway event. It's important to note that the delay is the ",(0,i.kt)("strong",{parentName:"p"},"accumulated"),' amount of flight time where the other criteria like throttle level, stick activity (minimum 15% deflection), etc. are met. Thus the "real" elapsed time before deactivation may be longer than 0.5 seconds if the throttle was dropping below the limit or if the R/P/Y sticks were centered. The actual behavior can be viewed by using blackbox logging - see the debugging section below.'),(0,i.kt)("h2",{id:"debugging"},"Debugging"),(0,i.kt)("p",null,"Additional data may be captured in a blackbox log that will give insight into the operation of the Runaway Takeoff Prevention feature. Enable capturing this additional data by:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"set debug_mode = RUNAWAY_TAKEOFF")),(0,i.kt)("p",null,"This will enable additional debug values in the log that can be used to observer the operation of the feature."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"debug","[0]")," - boolean value (0/1)"),(0,i.kt)("p",null,"This value indicates whether the feature is active (1) and in detection mode. Once successful flight deactivates the feature the value will be (0)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"debug","[1]")," - boolean value (0/1)"),(0,i.kt)("p",null,"Indicates whether the PID_sum value for some axis has exceeded the ",(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_threshold")," and we are in a countdown for ",(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_activate_delay")," milliseconds. The logic is preparing to auto-disarm assuming the PID_sum value continues to exceed the threshold."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"debug","[2]")," - boolean value (0/1)"),(0,i.kt)("p",null,"Indicates that the criteria for deactivation (throttle level, stick activity and PID response) has been met and we are accumulating in-flight time."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"debug","[3]")," - number"),(0,i.kt)("p",null,"Indicates the in-flight milliseconds accumulated so far. Once this reaches ",(0,i.kt)("inlineCode",{parentName:"p"},"runaway_takeoff_deactivate_delay")," the feature will be disabled. Any time debug","[2]"," = 1 then debug","[3]"," will be accumulating time."),(0,i.kt)("p",null,"As the Runaway Takeoff Prevention feature matures based on feedback from the user community the debugging features may become unnecessary and removed to save space some time in the future."),(0,i.kt)("h2",{id:"known-issues"},"Known Issues"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Crashing severely immediately on takeoff may cause an auto-disarm. Not really an issue and probably a good thing. Simply don't crash on takeoff. :)"),(0,i.kt)("li",{parentName:"ul"},"Severe bouncing/bumping the ground on takeoff may cause a disarm. This is not actually very likely to occur as it takes a really big hit to trigger the disarm with the default configuration."),(0,i.kt)("li",{parentName:"ul"},"Arming with no props and moving the R/P/Y sticks significantly may trigger a disarm. This is normal and is caused because the PID controller is trying to control the craft and it's not responding properly (because there are no props!). As a result the PID_sum values will grow as the PID controller begins to push harder and harder to make something happen. This can end up looking like a runaway PID_sum event. The feature has provisions in place to allow limited bench testing without disarming. Heavy yaw movements could still trigger a disarm but generally \"wiggling\" the sticks to see the motor responses won't be a problem. Testing ",(0,i.kt)("strong",{parentName:"li"},"while connected to the configurator")," will temporarily disable runaway takeoff prevention and allow unlimited bench testing without props."),(0,i.kt)("li",{parentName:"ul"},'"Hand flying" with the props off could trigger a disarm. ',(0,i.kt)("strong",{parentName:"li"},"NEVER TRY TO HOLD AN ARMED CRAFT IN YOUR HANDS WHILE THE PROPS ARE ON!!")," If the props are off and you move the craft around while the motors are spinning the PID controller will oppose the motion but because there are no props the PID_sum value will grow possibly triggering a disarm. On the other hand, holding the craft still while moving the sticks to feel the motor response will not trigger a disarm.")),(0,i.kt)("h2",{id:"version-history"},"Version History"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Betaflight 4.0")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Changed ",(0,i.kt)("inlineCode",{parentName:"li"},"runaway_takeoff_deactivate_throttle_percent")," default to 20.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Betaflight 3.3")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Simplified configuration by removing unnecessary tuning parameters ",(0,i.kt)("inlineCode",{parentName:"li"},"runaway_takeoff_threshold")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"runaway_takeoff_activate_delay"),". The previous default values were found to be appropriate and unnecessary to tune."),(0,i.kt)("li",{parentName:"ul"},"Enhance logic to accelerate deactivation under higher throttle conditions.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Betaflight 3.3RC3")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Added gyro rate checking to activation detection to improve bench testing")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Betaflight 3.3RC2")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Reactivate the feature after the pilot uses crash-flip to recover from a crash. Provides protection for the next arming and takeoff in case of broken props or other problems that might cause a runaway."),(0,i.kt)("li",{parentName:"ul"},"Disable the feature temporarily while crash-flip is active to prevent triggering while the pilot is attempting to flip over."),(0,i.kt)("li",{parentName:"ul"},"In coordination with Betaflight Configurator 10.2.0 or later, temporarily disable the feature when arming while connected to the configurator. This allows unrestricted bench testing without risk of triggering a disarm. Prevents any need to manually disable the feature which may result in forgetting to re-enable before flying.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Betaflight 3.3RC1")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Initial release")))}h.isMDXComponent=!0}}]);