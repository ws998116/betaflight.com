"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[817],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var i=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=i.createContext({}),c=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=c(e.components);return i.createElement(s.Provider,{value:n},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),d=c(t),m=o,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return t?i.createElement(h,l(l({ref:n},u),{},{components:t})):i.createElement(h,l({ref:n},u))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=m;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a[d]="string"==typeof e?e:o,l[1]=a;for(var c=2;c<r;c++)l[c]=t[c];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},20736:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=t(87462),o=(t(67294),t(3905));const r={},l=void 0,a={unversionedId:"development/development/Known-Build-Environment-Problems",id:"development/development/Known-Build-Environment-Problems",title:"Known-Build-Environment-Problems",description:"Cygwin on Windows",source:"@site/docs/development/development/Known-Build-Environment-Problems.md",sourceDirName:"development/development",slug:"/development/development/Known-Build-Environment-Problems",permalink:"/docs/development/development/Known-Build-Environment-Problems",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"development",previous:{title:"How-to-debug-Betaflight-configurator-with-Visual-Studio-Code",permalink:"/docs/development/development/How-to-debug-Betaflight-configurator-with-Visual-Studio-Code"},next:{title:"PID Internals",permalink:"/docs/development/development/PID Internals"}},s={},c=[{value:"Cygwin on Windows",id:"cygwin-on-windows",level:2},{value:"ccache",id:"ccache",level:3},{value:"clang",id:"clang",level:3},{value:"GNU ARM Toolchain Version",id:"gnu-arm-toolchain-version",level:2},{value:"Running a 32-bit Tool chain on a 64-bit Linux system",id:"running-a-32-bit-tool-chain-on-a-64-bit-linux-system",level:2},{value:"Linking Unit Tests may fail.",id:"linking-unit-tests-may-fail",level:2},{value:"Compiling Unit Tests fails with errors",id:"compiling-unit-tests-fails-with-errors",level:2},{value:"GLIBC issues on Alpine",id:"glibc-issues-on-alpine",level:2}],u={toc:c};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,i.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"cygwin-on-windows"},"Cygwin on Windows"),(0,o.kt)("h3",{id:"ccache"},"ccache"),(0,o.kt)("p",null,"ccache 3.1.9 in Cygwin 2.874 is broken. Returns false cache hits. Do not install. Betaflight build system uses ccache if available."),(0,o.kt)("h3",{id:"clang"},"clang"),(0,o.kt)("p",null,"Compiling the unittests using clang may fail on Cygwin. There is a version mismatch with Cygwin supplied <sys/unistd.h> and clang. Not easily fixed, needs a Cygwin patch. Do not run unittests on Cygwin. The error looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/include/sys/unistd.h:53:36: error: __block attribute not allowed, only allowed on local variables\nvoid    _EXFUN(encrypt, (char *__block, int __edflag));\n")),(0,o.kt)("p",null,"Using gcc works better with this particular problem, but fails in other places where clang is required."),(0,o.kt)("h2",{id:"gnu-arm-toolchain-version"},"GNU ARM Toolchain Version"),(0,o.kt)("p",null,"Using the 4.8-2014-q2 version of the ",(0,o.kt)("a",{parentName:"p",href:"https://launchpad.net/gcc-arm-embedded/+download"},"GNU ARM Toolchain"),' with Windows/Cygwin (recommended on the Cleanflight "',(0,o.kt)("a",{parentName:"p",href:"https://github.com/cleanflight/cleanflight/blob/master/docs/development/Building%20in%20Windows.md"},"Building in Windows.md"),'" page) lead to strange results. (When running a 2.9.1 version of Betaflight I built on NAZE the change-flight-mode beep would constantly sound when in Horizon mode.) Updating the toolchain to 4.9-2015-q3 and rebuilding fixed the issue (and also cleared some compiler warnings). BorisB mentions the toolchain version ',(0,o.kt)("a",{parentName:"p",href:"http://www.rcgroups.com/forums/showthread.php?p=34530653#post34530653"},"here"),".\nUpdate 2/2017: The Windows/Cygwin 'make' requests toolchain version 6.2.1, gcc-arm-none-eabi-6_2-2016q4-20161216-win32, available here: ",(0,o.kt)("a",{parentName:"p",href:"https://developer.arm.com/open-source/gnu-toolchain/gnu-rm"},"https://developer.arm.com/open-source/gnu-toolchain/gnu-rm")),(0,o.kt)("h2",{id:"running-a-32-bit-tool-chain-on-a-64-bit-linux-system"},"Running a 32-bit Tool chain on a 64-bit Linux system"),(0,o.kt)("p",null,'The arm-sdk installation done from the new "make arm_sdk_install" command will install a 32-bit variant of the tool chain. This may fail to execute on a 64-bit Linux system, bash will say "No such file or directory", if no support for 32-bit 386 program are installed. To install this:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo dpkg --add-architecture i386\n$ sudo apt-get update\n$ sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386\n")),(0,o.kt)("h2",{id:"linking-unit-tests-may-fail"},"Linking Unit Tests may fail."),(0,o.kt)("p",null,"When trying to build and run the unittests on Linux or WSL, you may encounter this problem:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"linking ../../obj/test/alignsensor_unittest/alignsensor_unittest\n/usr/bin/ld: cannot find -lBlocksRuntime\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n")),(0,o.kt)("p",null,"Problem is a missing library, install it this way:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo apt-get install libblocksruntime-dev\n")),(0,o.kt)("h2",{id:"compiling-unit-tests-fails-with-errors"},"Compiling Unit Tests fails with errors"),(0,o.kt)("p",null,"Betaflight has been updated to work with clang version 10 (12 on OS X) and will be the official supported (required) version from now on.\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"Makefile")," has been updated to be compatible with this version to run the tests successfully.\n",(0,o.kt)("inlineCode",{parentName:"p"},"make test")," depends on a specific ",(0,o.kt)("inlineCode",{parentName:"p"},"clang")," compiler. The codebase and tools are updated to work with version 10 on Linux and version 12 on OS X.\nUbuntu 20.04 LTS and Windows Subsystem for Linux should work with clang version 7, 8 or 10.\nOS X should support clang 7, 10 or 12. Install ",(0,o.kt)("inlineCode",{parentName:"p"},"clang")," on Ubuntu (or Ubuntu using WSL) using:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo apt update\n$ sudo apt install clang\n")),(0,o.kt)("h2",{id:"glibc-issues-on-alpine"},"GLIBC issues on Alpine"),(0,o.kt)("p",null,"Please see: ",(0,o.kt)("a",{parentName:"p",href:"https://wiki.alpinelinux.org/wiki/Running_glibc_programs"},"Apline wiki")))}d.isMDXComponent=!0}}]);